@namespace Cardalog.Shared.Components
@using Cardalog.Models

@if (Cards.Count() > 0 && GetMatches().Count() > 0)
{
  <InputSelect id="mtg-card-select" @bind-Value="title">
    <option value="Matches">Matches</option>
    @foreach (var title in GetMatches())
    {
      <option value="@title" @onclick="OnClick">@title</option>
    }
  </InputSelect>
}

@code {
  [Parameter]
  public IEnumerable<Card> Cards { get; set; }

  [Parameter]
  public string SearchTerm { get; set; }

  [Parameter]
  public EventCallback<string> CardSelected { get; set; }

  private string title;

  public IEnumerable<string> GetMatches()
  {
    if (SearchTerm?.Length > 0)
    {
      return (from c in Cards
             where c.Title.StartsWith(SearchTerm, true, System.Globalization.CultureInfo.InvariantCulture)
             select c.Title).Distinct();
    }
    return new List<string>();
  }

  private void OnClick()
  {
    Console.WriteLine($"Clicked value {title}");
    CardSelected.InvokeAsync(title);
    title = null; // Title must be reset else the drop down list misbehaves when the search term is changed.
  }
}